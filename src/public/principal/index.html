<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botão Mapa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css\index.css">
</head>

<body>
    <header class="bg-white py-3 px-4 d-flex align-items-center">
        <div class="logo-container">
            <img src="img/logoMenuFlash.png" alt="Logo Menu Flash" class="img-fluid logo-img">
        </div>

        <div class="fw-bold text-dark px-5 d-flex gap-4" id="linksDoUsuario">

        </div>
    </header>

    <main class="py-5 px-4 container text-center text-white">
        <h1 id="nome-campus" class="mb-4">Escolha seu campus</h1>

        <div id="lanchonetes-container" class="mt-4"></div>

        <div class="row row-cols-1 row-cols-md-1 gy-4 gx-4">

            <div class="col">
                <a href="campusCoreu.html">
                    <div class="card bg-dark text-white border-0 shadow" style="cursor: pointer;"
                        onclick="irParaMapa('Coreu')">
                        <img src="img\campus-coreu.jpg" class="card-img" alt="Coração Eucarístico"
                            style="height: 200px; object-fit: cover;">
                        <div class="card-img-overlay d-flex align-items-center justify-content-center">
                            <h4 class="card-title bg-dark bg-opacity-75 px-3 py-2 rounded">Coração Eucarístico</h4>
                        </div>
                    </div>
                </a>
            </div>

            <div class="col">
                <a href="campusContagem.html">
                    <div class="card bg-dark text-white border-0 shadow" style="cursor: pointer;"
                        onclick="irParaMapa('Outros')">
                        <img src="img/campus-contagem.png" class="card-img" alt="Contagem"
                            style="height: 200px; object-fit: cover;">
                        <div class="card-img-overlay d-flex align-items-center justify-content-center">
                            <h4 class="card-title bg-dark bg-opacity-75 px-3 py-2 rounded">Contagem</h4>
                        </div>
                    </div>
                </a>
            </div>

        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/index.js"></script>

</body>

</html>

<script>
    // Este script deve rodar em TODAS as páginas que têm o link de "Entrar"
    document.addEventListener('DOMContentLoaded', function () {
        const linkParaLogin = document.querySelector('a[href*="login.html"]'); // Um seletor mais genérico

        if (linkParaLogin) {
            const urlAtual = window.location.href;
            // A mágica acontece aqui:
            // Nós pegamos o href original e adicionamos o parâmetro `redirectUrl`.
            // Usamos encodeURIComponent para garantir que caracteres especiais na URL não quebrem o link.
            linkParaLogin.href = linkParaLogin.href + `?redirectUrl=${encodeURIComponent(urlAtual)}`;
        }
    });


    // Ver se o usuario esta logado 
    let usuario = null;

    function checarUsuarioLogado() {
        const usuarioLogadoStr = sessionStorage.getItem('usuarioLogado');
        if (!usuarioLogadoStr) {
            return false;
        }
        usuario = JSON.parse(usuarioLogadoStr);
        return true;
    }
    // Função para remover Login do Session
    function sairUsuario(event) {
        event.preventDefault();
        sessionStorage.removeItem('usuarioLogado');
        window.location.href = "cadastro_login/login.html";
    }

    window.onload = () => {

        const linksContainer = document.querySelector('#linksDoUsuario');
        let linksHTML = '';

        if (checarUsuarioLogado()) {
            if (usuario.tipo === 'administrador') {
                // Links para administrador
                linksHTML = `
            <ul class="navbar-nav d-flex flex-row gap-4 align-items-center">
                <li class="nav-item">
                    <a class="nav-link fs-5" href="#">Cadastro de Itens</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link fs-5" href="../perfil/perfil.html">Perfil</a>
                </li>
                <li class="nav-item">
                    <a id="sairLink" class="nav-link fs-5" href="../cadastro_login/login.html">Sair da Conta</a>
                </li>
            </ul>
        `;
            } else {
                // Links para usuário padrão
                linksHTML = `
            <ul class="navbar-nav d-flex flex-row gap-4 align-items-center">
                <li class="nav-item">
                    <a class="nav-link fs-5" href="../perfil/perfil.html">Perfil</a>
                </li>
                <li class="nav-item">
                    <a id="sairLink" class="nav-link fs-5" href="../cadastro_login/login.html">Sair</a>
                </li>
            </ul>
        `;
            }
        } else {
            // Links para usuário deslogado.
            linksHTML = `
        <ul class="navbar-nav d-flex flex-row gap-4 align-items-center">
            <li class="nav-item">
                <a class="nav-link fs-5" href="../cadastro_login/login.html">Entrar</a>
            </li>
            <li class="nav-item">
                <a class="nav-link fs-5" href="../cadastro_login/cadastroUsuario.html">Cadastre-se</a>
            </li>
        </ul>
    `;
        }


        if (linksContainer) {
            linksContainer.innerHTML = linksHTML;
        }

        if (checarUsuarioLogado()) {
            const sairLink = document.querySelector('#sairLink');
            if (sairLink) {
                sairLink.addEventListener('click', sairUsuario);
            }
        }
    };

</script>